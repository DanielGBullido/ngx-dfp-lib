!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("rxjs"),require("@angular/router"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ngx-dfp",["exports","@angular/core","@angular/common","rxjs","@angular/router","rxjs/operators"],e):e(t["ngx-dfp"]={},t.ng.core,t.ng.common,t.rxjs,t.ng.router,t.rxjs.operators)}(this,function(t,c,p,s,f,u){"use strict";var r=new c.InjectionToken("dfpConfig"),i=function(){function t(t,e){var r=p.isPlatformBrowser(t)?window:{};r.requestIdleCallback?this.requestIdleCallback=function(t){return r.requestIdleCallback(t)}:this.requestIdleCallback=function(t){return e.runOutsideAngular(function(){return r.setTimeout(t,50)})}}return t.prototype.request=function(t){this.requestIdleCallback(t)},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:Object,decorators:[{type:c.Inject,args:[c.PLATFORM_ID]}]},{type:c.NgZone}]},t}(),e=function(){function t(){this.isErrorCode=function(t){return"number"==typeof t?!(200<=t&&t<300):"2"!==t[0]}}return t.prototype.httpError=function(t,e){console.log("Error ("+t.status+") "+(e||""))},t.decorators=[{type:c.Injectable}],t}(),n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function o(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function a(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var i,n,o=r.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(i=o.next()).done;)s.push(i.value)}catch(a){n={error:a}}finally{try{i&&!i.done&&(r=o["return"])&&r.call(o)}finally{if(n)throw n.error}}return s}function l(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(a(arguments[e]));return t}var h=function(e){function t(t){return e.call(this,"Invalid interval: '"+t+"'ls")||this}return o(t,e),t}(Error),d=function(){function t(){}return t.prototype.convertToMilliseconds=function(t,e){return console.assert(/^(m?s|min|h)$/g.test(e)),"ms"===e?t:"s"===e?1e3*t:"min"===e?60*t*1e3:60*t*60*1e3},t.prototype.convert=function(t){var e=parseFloat(t[1]);return 2===t.length?e:this.convertToMilliseconds(e,t[2])},t.prototype.parseDuration=function(t){if(t===undefined||null===t)throw new h(t);if("number"==typeof t)return t;if("string"!=typeof t)throw new TypeError("'"+t+"' must be of number or string type");var e=t.match(/((?:\d+)?.?\d+)(m?s|min|h)?/);if(!e)throw new h(t);return this.convert(e)},t.decorators=[{type:c.Injectable}],t}(),g=function(){function t(t){this.httpError=t}return t.prototype.completeURL=function(t){return("https:"===document.location.protocol?"https:":"http:")+t},t.prototype.createScript=function(t){var e=document.createElement("script");return e.async=!0,e.type="text/javascript",e.src=this.completeURL(t),e},t.prototype.promiseScript=function(r,i){var e=this,t=new Promise(function(t,e){r.onload=function(){t(r)},r.onerror=function(){e({path:i,loaded:!1})}});return t["catch"](function(t){e.httpError.httpError({status:400},'loading script "'+i+'"')}),t},t.prototype.injectScript=function(t){(document.head||document.querySelector("head")).appendChild(t)},t.prototype.scriptInjector=function(t){var e=this.createScript(t);return this.injectScript(e),this.promiseScript(e,t)},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:e}]},t}(),y=function(i){function t(t,e,r){return i.call(this,"Incomplete definition of '"+t+"': Missing "+(r?"attribute":"child directive")+" '"+e+"'.")||this}return o(t,i),t}(Error),m=(function(n){function t(t,e,r,i){return n.call(this,"Wrong type for attribute '"+e+"' on directive '"+t+"': Expected "+i+", got "+typeof r)||this}o(t,n)}(Error),function(n){function t(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var i;return console.assert(e&&0<e.length),Array.isArray(e[0])&&(e=e[0]),1<e.length?(i=", which must be ",i+=(e=e.map(function(t){return"'"+t+"'"})).slice(0,-1).join(", "),i+=" or "+e[e.length-1]):i=" '"+e[0]+"'",n.call(this,"Invalid use of '"+t+"' directive. Missing parent directive"+i+".")||this}o(t,n)}(Error),function k(){}),v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(Error),I=function(){function t(t,e,r,i){var n=this;if(this.platformId=t,this.config=r,this.scriptInjector=i,this.enableVideoAds=!1,this.personalizedAds=!0,this.collapseIfEmpty=!0,this.centering=!1,this.location=null,this.ppid=null,this.globalTargeting=null,this.forceSafeFrame=!1,this.safeFrameConfig=null,this.loadGPT=!0,this.loaded=!1,p.isPlatformBrowser(this.platformId)){var o=window,s=o.googletag||{};if(this.dfpConfig(),s.cmd=s.cmd||[],s.cmd.push(function(){n.setup()}),o.googletag=s,this.loadGPT){var a=function(){n.scriptInjector.scriptInjector("//www.googletagservices.com/tag/js/gpt.js").then(function(t){n.loaded=!0})};e?e.request(a):a()}}}return t.prototype.dfpConfig=function(){for(var t in this.config)this.hasOwnProperty(t)&&(this[t]=this.config[t])},t.prototype.addSafeFrameConfig=function(t){if(!this.safeFrameConfig)return!1;if("object"!=typeof this.safeFrameConfig)throw new v("FrameConfig must be an object");t.setSafeFrameConfig(this.safeFrameConfig)},t.prototype.addTargeting=function(t){if(!this.globalTargeting)return!1;if("object"!=typeof this.globalTargeting)throw new v("Targeting must be an object");for(var e in this.globalTargeting)this.globalTargeting.hasOwnProperty(e)&&t.setTargeting(e,this.globalTargeting[e])},t.prototype.addLocation=function(t){if(!this.location)return!1;if("string"!=typeof this.location){if(!Array.isArray(this.location))throw new v("Location must be an array or string");t.setLocation.apply(t,this.location)}else t.setLocation(this.location)},t.prototype.addPPID=function(t){if(!this.ppid)return!1;if("string"!=typeof this.ppid)throw new v("PPID must be a string");t.setPublisherProvidedId(this.ppid)},t.prototype.setup=function(){var t=window.googletag,e=t.pubads();this.enableVideoAds&&e.enableVideoAds(),!1===this.personalizedAds&&e.setRequestNonPersonalizedAds(1),this.collapseIfEmpty&&e.collapseEmptyDivs(),e.disableInitialLoad(),e.setForceSafeFrame(this.forceSafeFrame),e.setCentering(this.centering),this.addLocation(e),this.addPPID(e),this.addTargeting(e),this.addSafeFrameConfig(e),e.enableAsyncRendering(),!0!==this.config.singleRequestMode&&(this.config.enableVideoAds&&e.enableVideoAds(),t.enableServices())},t.prototype.hasLoaded=function(){return this.loaded},t.prototype.defineTask=function(t){p.isPlatformBrowser(this.platformId)&&window.googletag.cmd.push(t)},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:Object,decorators:[{type:c.Inject,args:[c.PLATFORM_ID]}]},{type:i,decorators:[{type:c.Optional}]},{type:m,decorators:[{type:c.Inject,args:[r]}]},{type:g}]},t}(),b=function(){function t(){this.generatedIDs={}}return t.prototype.generateID=function(t){void 0===t&&(t="dfp-ad");var e=null;do{e=t+"-"+Math.random().toString().slice(2)}while(e in this.generatedIDs);return this.generatedIDs[e]=!0,e},t.prototype.dfpIDGenerator=function(t){if(t&&t.id&&!(t.id in this.generatedIDs))return t.id;var e=this.generateID(t.tagName.toLowerCase());return t&&(t.id=e),e},t.prototype.isTaken=function(t){return t in this.generatedIDs},t.prototype.isUnique=function(t){return!this.isTaken(t)},t.decorators=[{type:c.Injectable}],t}(),w=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(Error),S=function(){function t(t,e,r){this.config=t,this.inject=e,this.parseDuration=r,this.refreshEvent=new c.EventEmitter,this.refreshSlots=[],this.intervals={}}return t.prototype.slotRefresh=function(t,e,r){var i=this;void 0===r&&(r=!1);var n=s.from([t]).toPromise(),o={slot:t,deferred:n};return n.then(function(){i.hasSlotInterval(t)&&i.cancelInterval(t),e&&i.addSlotInterval(o,e)}),!0===this.config.singleRequestMode&&r?(this.refreshSlots.push(t),this.singleRequest&&!this.singleRequest.closed&&this.singleRequest.unsubscribe(),this.singleRequest=s.timer(100).subscribe(function(){var t=googletag.pubads();t.enableSingleRequest(),googletag.enableServices(),i.refreshSlots.forEach(function(t){googletag.display(t.getSlotElementId())}),t.refresh(i.refreshSlots),i.refreshSlots=[]})):(googletag.display(t.getSlotElementId()),this.refresh([o])),n},t.prototype.cancelInterval=function(t){if(!this.hasSlotInterval(t))throw new w("No interval for given slot");return this.intervals[this.slotIntervalKey(t)].unsubscribe(),delete this.intervals[t],this},t.prototype.hasSlotInterval=function(t){return this.slotIntervalKey(t)in this.intervals},t.prototype.refresh=function(t){if(t!==undefined)return 0!==t.length&&void googletag.cmd.push(function(){googletag.pubads().refresh(t.map(function(t){return t.slot})),t.forEach(function(t){Promise.resolve(t.slot)})});googletag.cmd.push(function(){googletag.pubads().refresh()})},t.prototype.addSlotInterval=function(e,t){var r=this,i=this.parseDuration.parseDuration(t);this.validateInterval(i,t);var n=s.timer(i,i).subscribe(function(){var t=r.inject.get(p.DOCUMENT);r.hiddenCheck(t.getElementById(e.slot.getSlotElementId()))||(r.refresh([e]),r.refreshEvent.emit(e.slot))});return this.intervals[this.slotIntervalKey(e.slot)]=n},t.prototype.slotIntervalKey=function(t){return t.getSlotId().getDomId()},t.prototype.validateInterval=function(t,e){t<1e3&&console.warn("Careful: ${beforeParsing} is quite a low interval!")},t.prototype.hiddenCheck=function(t){if("undefined"!=typeof window&&null!=t){if("none"===window.getComputedStyle(t).display)return!0;if(t.parentElement)return this.hiddenCheck(t.parentElement)}return!1},t.decorators=[{type:c.Injectable}],t.ctorParameters=function(){return[{type:m,decorators:[{type:c.Optional},{type:c.Inject,args:[r]}]},{type:c.Injector},{type:d}]},t}(),E=function(){function t(t,e,r,i,n,o,s){var a=this;this.platformId=t,this.elementRef=e,this.dfp=r,this.dfpIDGenerator=i,this.dfpRefresh=n,this.config=o,this.personalizedAds=this.config.personalizedAds,this.afterRefresh=new c.EventEmitter,this.sizes=[],this.responsiveMapping=[],this.targetings=[],this.exclusions=[],this.scripts=[],p.isPlatformBrowser(this.platformId)&&(this.dfpRefresh.refreshEvent.subscribe(function(t){t===a.slot&&a.afterRefresh.emit({type:"refresh",slot:t})}),s&&(this.onSameNavigation=s.events.pipe(u.filter(function(t){return t instanceof f.NavigationEnd})).subscribe(function(t){a.slot&&!a.refresh&&"refresh"===a.config.onSameNavigation&&a.refreshContent.call(a)})))}return t.prototype.ngOnInit=function(){p.isPlatformBrowser(this.platformId)&&this.dfpIDGenerator.dfpIDGenerator(this.elementRef.nativeElement)},t.prototype.ngAfterViewInit=function(){var t=this;p.isPlatformBrowser(this.platformId)&&this.dfp.defineTask(function(){t.defineSlot()})},t.prototype.ngOnDestroy=function(){this.slot&&googletag.destroySlots([this.slot]),this.onSameNavigation&&this.onSameNavigation.unsubscribe()},t.prototype.setResponsiveMapping=function(t){var e=this.getState();if(0!==e.responsiveMapping.length){var r=googletag.sizeMapping();e.responsiveMapping.forEach(function(t){r.addSize(t.viewportSize,t.adSizes)}),t.defineSizeMapping(r.build())}},t.prototype.defineSlot=function(){var e=this,t=this.getState(),r=this.elementRef.nativeElement;this.slot=googletag.defineSlot(t.adUnit,t.sizes,r.id),this.forceSafeFrame!==undefined&&t.forceSafeFrame===!this.config.forceSafeFrame&&this.slot.setForceSafeFrame(t.forceSafeFrame),!1===this.personalizedAds&&(this.slot.set("requestNonPersonalizedAds",1),googletag.pubads().setRequestNonPersonalizedAds(1)),t.clickUrl&&this.slot.setClickUrl(t.clickUrl),t.collapseIfEmpty&&this.slot.setCollapseEmptyDiv(!0,!0),t.safeFrameConfig&&this.slot.setSafeFrameConfig(JSON.parse(t.safeFrameConfig)),this.slot.renderEnded=function(t){e.afterRefresh.emit({type:"renderEnded",slot:e.slot,data:t})},this.setResponsiveMapping(this.slot),t.targetings.forEach(function(t){e.slot.setTargeting(t.key,t.values)}),t.exclusions.forEach(function(t){e.slot.setCategoryExclusion(t)}),t.scripts.forEach(function(t){t(e.slot)}),this.config.enableVideoAds&&this.slot.addService(googletag.companionAds()),this.slot.addService(googletag.pubads()),this.refreshContent()},t.prototype.refreshContent=function(){var e=this;this.dfpRefresh.slotRefresh(this.slot,this.refresh,!0).then(function(t){e.afterRefresh.emit({type:"init",slot:t})})},t.prototype.checkValid=function(){if(0===this.sizes.length)throw new y("dfp-ad","dfp-size");if(!this.adUnit)throw new y("dfp-ad","ad-unit",!0)},Object.defineProperty(t.prototype,"isHidden",{get:function(){return this.dfpRefresh.hiddenCheck(this.elementRef.nativeElement)},enumerable:!0,configurable:!0}),t.prototype.getState=function(){return this.checkValid(),Object.freeze({sizes:this.sizes,responsiveMapping:this.responsiveMapping,targetings:this.targetings,exclusions:this.exclusions,adUnit:this.adUnit,forceSafeFrame:!0===this.forceSafeFrame,safeFrameConfig:this.safeFrameConfig,clickUrl:this.clickUrl,refresh:this.refresh,personalizedAds:this.personalizedAds===this.config.personalizedAds,scripts:this.scripts,collapseIfEmpty:!0===this.collapseIfEmpty})},t.prototype.addSize=function(t){this.sizes.push(t)},t.prototype.addResponsiveMapping=function(t){this.responsiveMapping.push(t)},t.prototype.addTargeting=function(t){this.targetings.push(t)},t.prototype.addExclusion=function(t){this.exclusions.push(t)},t.prototype.addScript=function(t){this.scripts.push(t)},t.decorators=[{type:c.Directive,args:[{selector:"dfp-ad"}]}],t.ctorParameters=function(){return[{type:Object,decorators:[{type:c.Inject,args:[c.PLATFORM_ID]}]},{type:c.ElementRef},{type:I},{type:b},{type:S},{type:m,decorators:[{type:c.Inject,args:[r]}]},{type:f.Router,decorators:[{type:c.Optional}]}]},t.propDecorators={adUnit:[{type:c.Input}],clickUrl:[{type:c.Input}],forceSafeFrame:[{type:c.Input}],safeFrameConfig:[{type:c.Input}],refresh:[{type:c.Input}],personalizedAds:[{type:c.Input}],collapseIfEmpty:[{type:c.Input}],afterRefresh:[{type:c.Output}]},t}(),R=function(){function t(t,e,r){var i=this;this.elementRef=t,this.ad=e,this.dfpRefresh=r,this.ad.afterRefresh.subscribe(function(t){i.slot=t.slot})}return t.prototype.normalizeIframe=function(){var e=this;if(this.ad.isHidden)return!1;if(this.iframe=this.iframe||this.getIframe(),!this.iframe)return!1;this.iframeWidth=this.iframeWidth||+this.iframe.width;var r=window.innerWidth,t=this.ad.getState(),i=0;t.sizes.forEach(function(t){t[0]<r&&(i=Math.max(i,t[0]))}),1<t.sizes.length&&i!==this.iframeWidth&&(t=this.ad.getState(),this.iframeWidth=i,this.iframe.setAttribute("width",i+""),this.dfpRefresh.slotRefresh(this.slot,t.refresh).then(function(t){e.ad.afterRefresh.emit({type:"resize",slot:t}),e.iframe=e.getIframe()}))},t.prototype.getIframe=function(){var t=this.elementRef.nativeElement.querySelector("iframe");if(t&&0<+t.width)return t},t.decorators=[{type:c.Directive,args:[{selector:"dfp-ad[responsive]"}]}],t.ctorParameters=function(){return[{type:c.ElementRef},{type:E,decorators:[{type:c.Inject,args:[c.forwardRef(function(){return E})]}]},{type:S}]},t.propDecorators={normalizeIframe:[{type:c.HostListener,args:["window:resize"]}]},t}(),D=function(){function t(t){this.ad=t,this.viewport=[0,0],this.adSizes=[]}return t.prototype.ngOnInit=function(){this.ad.addResponsiveMapping(this.getState())},Object.defineProperty(t.prototype,"viewWidth",{set:function(t){0<t&&(this.viewport[0]=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewHeight",{set:function(t){0<t&&(this.viewport[1]=t)},enumerable:!0,configurable:!0}),t.prototype.addSize=function(t){this.adSizes.push(t)},t.prototype.getState=function(){return Object.freeze({viewportSize:this.viewport,adSizes:this.adSizes})},t.decorators=[{type:c.Directive,args:[{selector:"dfp-responsive"}]}],t.ctorParameters=function(){return[{type:E,decorators:[{type:c.Inject,args:[c.forwardRef(function(){return E})]}]}]},t.propDecorators={viewport:[{type:c.Input}],adSizes:[{type:c.Input}],viewWidth:[{type:c.Input}],viewHeight:[{type:c.Input}]},t}(),j=function(){function t(t,e,r){this.elementRef=t,this.ad=e,this.resp=r}return t.prototype.ngOnInit=function(){var t=this.resp||this.ad,e=this.elementRef.nativeElement.innerText;this.width&&this.height?t.addSize([this.width,this.height]):""!==e.trim()&&t.addSize(e)},t.decorators=[{type:c.Directive,args:[{selector:"dfp-size"}]}],t.ctorParameters=function(){return[{type:c.ElementRef},{type:E,decorators:[{type:c.Inject,args:[c.forwardRef(function(){return E})]}]},{type:D,decorators:[{type:c.Optional},{type:c.Inject,args:[c.forwardRef(function(){return D})]}]}]},t.propDecorators={width:[{type:c.Input}],height:[{type:c.Input}]},t}(),P=function(){function t(t){this.ad=t,this.values=[]}return Object.defineProperty(t.prototype,"value",{set:function(t){var e=this;t instanceof Array?t.forEach(function(t){return e.addValue(t)}):this.addValue(t)},enumerable:!0,configurable:!0}),t.prototype.ngAfterContentInit=function(){var t=this.getState();this.ad.addTargeting(t)},t.prototype.checkValid=function(){if(this.key===undefined)throw new y("dfp-targeting","key",!0);if(0===this.values.length)throw new y("dfp-targeting","value",!0)},t.prototype.getState=function(){return this.checkValid(),Object.freeze({key:this.key,values:this.values})},t.prototype.addValue=function(e){e&&!this.values.find(function(t){return t===e})&&this.values.push(e)},t.decorators=[{type:c.Directive,args:[{selector:"dfp-targeting"}]}],t.ctorParameters=function(){return[{type:E,decorators:[{type:c.Inject,args:[c.forwardRef(function(){return E})]}]}]},t.propDecorators={key:[{type:c.Input}],value:[{type:c.Input}]},t}(),z=function(){function t(t,e){this.elementRef=t,this.ad=e}return t.prototype.ngOnInit=function(){this.ad.addExclusion(this.elementRef.nativeElement.innerText)},t.decorators=[{type:c.Directive,args:[{selector:"dfp-exclusion"}]}],t.ctorParameters=function(){return[{type:c.ElementRef},{type:E,decorators:[{type:c.Inject,args:[c.forwardRef(function(){return E})]}]}]},t}(),C=function(){function t(t,e){this.elementRef=t,this.targeting=e}return t.prototype.ngOnInit=function(){this.targeting.addValue(this.elementRef.nativeElement.innerText)},t.decorators=[{type:c.Directive,args:[{selector:"dfp-value"}]}],t.ctorParameters=function(){return[{type:c.ElementRef},{type:P,decorators:[{type:c.Inject,args:[c.forwardRef(function(){return P})]}]}]},t}(),O=function(){function t(t,e){this.platformId=t,this.elementRef=e}return t.prototype.ngOnInit=function(){if(p.isPlatformBrowser(this.platformId)){var t=1e13*Math.random(),e="";this.adUnit&&(e="dc_iu="+this.adUnit);var r="";this.ppid&&(r="ppid="+this.ppid);var i=document.createElement("img");i.src="https://pubads.g.doubleclick.net/activity;ord=",i.src+=t+";dc_seg="+this.segmentId+";"+e+r,i.width=1,i.height=1,i.border="0",i.style.visibility="hidden",this.elementRef.nativeElement.append(i)}},t.decorators=[{type:c.Directive,args:[{selector:"dfp-audience-pixel"}]}],t.ctorParameters=function(){return[{type:Object,decorators:[{type:c.Inject,args:[c.PLATFORM_ID]}]},{type:c.ElementRef}]},t.propDecorators={adUnit:[{type:c.Input}],segmentId:[{type:c.Input}],ppid:[{type:c.Input}]},t}(),A=[E,j,D,R,P,z,C,O],F=[e,d,g,I,b,S],T=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:l(t&&!0===t.idleLoad?[i]:[],[{provide:r,useValue:t||{}}])}},e.decorators=[{type:c.NgModule,args:[{imports:[],declarations:l(A),providers:l(F),exports:l(A)}]}],e}();t.DfpModule=T,t.DFP_CONFIG=r,t.IdleService=i,t.HttpErrorService=e,t.ParseDurationService=d,t.ScriptInjectorService=g,t.DfpService=I,t.DfpIDGeneratorService=b,t.DfpRefreshService=S,t.DfpAdDirective=E,t.DfpAdResponsiveDirective=R,t.DfpResponsiveDirective=D,t.DfpSizeDirective=j,t.DfpTargetingDirective=P,t.DfpExclusionDirective=z,t.DfpValueDirective=C,t.DfpAudiencePixelDirective=O,t.ɵe=m,t.ɵm=R,t.ɵa=E,t.ɵq=O,t.ɵo=z,t.ɵl=D,t.ɵk=j,t.ɵn=P,t.ɵp=C,t.ɵh=b,t.ɵi=S,t.ɵc=I,t.ɵg=e,t.ɵd=i,t.ɵb=r,t.ɵj=d,t.ɵf=g,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-dfp.umd.min.js.map