!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@alugha/ima")):"function"==typeof define&&define.amd?define("ngx-dfp/video",["exports","@angular/core","@angular/common","@alugha/ima"],t):t((e["ngx-dfp"]=e["ngx-dfp"]||{},e["ngx-dfp"].video={}),e.ng.core,e.ng.common,e.ima)}(this,function(e,i,n,o){"use strict";var t=function(){function e(){this.generatedIDs={}}return e.prototype.generateID=function(e){void 0===e&&(e="dfp-ad");var t=null;do{t=e+"-"+Math.random().toString().slice(2)}while(t in this.generatedIDs);return this.generatedIDs[t]=!0,t},e.prototype.dfpIDGenerator=function(e){if(e&&e.id&&!(e.id in this.generatedIDs))return e.id;var t=this.generateID(e.tagName.toLowerCase());return e&&(e.id=t),t},e.prototype.isTaken=function(e){return e in this.generatedIDs},e.prototype.isUnique=function(e){return!this.isTaken(e)},e.decorators=[{type:i.Injectable}],e}(),r=function(){function e(e,t,n,o){this.platformId=e,this.elementRef=t,this.renderer=n,this.dfpIDGenerator=o,this.adEvents=new i.EventEmitter,this.adsDone=!1}return e.prototype.ngOnInit=function(){var t=this;if(n.isPlatformBrowser(this.platformId)){var e=this.elementRef.nativeElement;this.dfpIDGenerator.dfpIDGenerator(e),this.contentPlayer=e.querySelector("video"),this.renderer.setAttribute(this.contentPlayer,"width",this.width.toString()),this.renderer.setAttribute(this.contentPlayer,"height",this.height.toString()),this.adContainer=e.querySelector(".ad-container"),this.adContainer||(this.adContainer=this.renderer.createElement("div"),this.renderer.addClass(this.adContainer,"ad-container"),this.renderer.appendChild(e,this.adContainer)),o.loadImaSdk().then(function(){return t.setUpIMA()}),this.adActions.subscribe(function(e){switch(e){case"play":t.play();break;case"pause":t.pause();break;case"resume":t.resume()}})}},e.prototype.play=function(){this.adsDone||(this.initialUserAction(),this.loadAds(),this.adsDone=!0)},e.prototype.pause=function(){this.adsManager&&this.adsManager.pause()},e.prototype.resume=function(){this.adsManager&&this.adsManager.resume()},e.prototype.setUpIMA=function(){var t=this;this.adDisplayContainer=new google.ima.AdDisplayContainer(this.adContainer,this.contentPlayer),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(e){return t.onAdsManagerLoaded(e)},!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(e){return t.onAdError(e)},!1),this.contentPlayer.onended=function(){t.contentEnded()}},e.prototype.initialUserAction=function(){this.adDisplayContainer.initialize(),this.contentPlayer.load()},e.prototype.requestAds=function(e){var t=new google.ima.AdsRequest;t.adTagUrl=e,t.linearAdSlotWidth=this.width,t.linearAdSlotHeight=this.height,t.nonLinearAdSlotWidth=this.width,t.nonLinearAdSlotHeight=this.height,this.adsLoader.requestAds(t)},e.prototype.contentEnded=function(){this.contentCompleteCalled=!0,this.adsLoader.contentComplete()},e.prototype.onAdsManagerLoaded=function(e){var t=new google.ima.AdsRenderingSettings;t.restoreCustomPlaybackStateOnAdBreakComplete=!0,this.adsManager=e.getAdsManager(this.contentPlayer,t),this.startAdsManager(this.adsManager)},e.prototype.startAdsManager=function(t){var n=this;t.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,function(){return n.onContentPauseRequested()},!1,this),t.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,function(){return n.onContentResumeRequested()},!1,this),t.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(e){return n.onAdError(e)},!1,this),[google.ima.AdEvent.Type.ALL_ADS_COMPLETED,google.ima.AdEvent.Type.CLICK,google.ima.AdEvent.Type.COMPLETE,google.ima.AdEvent.Type.FIRST_QUARTILE,google.ima.AdEvent.Type.LOADED,google.ima.AdEvent.Type.MIDPOINT,google.ima.AdEvent.Type.PAUSED,google.ima.AdEvent.Type.STARTED,google.ima.AdEvent.Type.THIRD_QUARTILE].forEach(function(e){return t.addEventListener(e,function(e){return n.onAdEvent(e)},!1)}),t.init(this.width,this.height,google.ima.ViewMode.NORMAL),t.start()},e.prototype.onContentPauseRequested=function(){this.pauseForAd()},e.prototype.onContentResumeRequested=function(){this.contentCompleteCalled||this.resumeAfterAd()},e.prototype.onAdEvent=function(e){e.type===google.ima.AdEvent.Type.LOADED&&(e.getAd().isLinear()||this.onContentResumeRequested());this.adEvents.emit(e)},e.prototype.onAdError=function(e){this.adsManager&&this.adsManager.destroy(),this.resumeAfterAd(),this.adEvents.emit(e)},e.prototype.resumeAfterAd=function(){this.contentPlayer.play()},e.prototype.pauseForAd=function(){this.contentPlayer.pause()},e.prototype.loadAds=function(){this.requestAds(this.adTag)},e.decorators=[{type:i.Directive,args:[{selector:"dfp-video"}]}],e.ctorParameters=function(){return[{type:Object,decorators:[{type:i.Inject,args:[i.PLATFORM_ID]}]},{type:i.ElementRef},{type:i.Renderer2},{type:t}]},e.propDecorators={width:[{type:i.Input}],height:[{type:i.Input}],adTag:[{type:i.Input}],adActions:[{type:i.Input}],adEvents:[{type:i.Output}]},e}(),a=function(){function e(){}return e.decorators=[{type:i.NgModule,args:[{declarations:[r],exports:[r],providers:[t]}]}],e}();e.DfpVideoDirective=r,e.DfpVideoModule=a,e.Éµa=t,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-dfp-video.umd.min.js.map